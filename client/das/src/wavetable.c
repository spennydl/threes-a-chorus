#include "das/wavetable.h"
#include <malloc.h>
#include <math.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>

static double sine_table[] = { 0,
                               0.024541228522912,
                               0.049067674327418,
                               0.073564563599667,
                               0.098017140329561,
                               0.122410675199216,
                               0.146730474455362,
                               0.170961888760301,
                               0.195090322016128,
                               0.219101240156870,
                               0.242980179903264,
                               0.266712757474898,
                               0.290284677254462,
                               0.313681740398892,
                               0.336889853392220,
                               0.359895036534988,
                               0.382683432365090,
                               0.405241314004990,
                               0.427555093430282,
                               0.449611329654607,
                               0.471396736825998,
                               0.492898192229784,
                               0.514102744193222,
                               0.534997619887097,
                               0.555570233019602,
                               0.575808191417845,
                               0.595699304492433,
                               0.615231590580627,
                               0.634393284163645,
                               0.653172842953777,
                               0.671558954847018,
                               0.689540544737067,
                               0.707106781186547,
                               0.724247082951467,
                               0.740951125354959,
                               0.757208846506485,
                               0.773010453362737,
                               0.788346427626606,
                               0.803207531480645,
                               0.817584813151584,
                               0.831469612302545,
                               0.844853565249707,
                               0.857728610000272,
                               0.870086991108711,
                               0.881921264348355,
                               0.893224301195515,
                               0.903989293123443,
                               0.914209755703531,
                               0.923879532511287,
                               0.932992798834739,
                               0.941544065183021,
                               0.949528180593037,
                               0.956940335732209,
                               0.963776065795440,
                               0.970031253194544,
                               0.975702130038529,
                               0.980785280403230,
                               0.985277642388941,
                               0.989176509964781,
                               0.992479534598710,
                               0.995184726672197,
                               0.997290456678690,
                               0.998795456205172,
                               0.999698818696204,
                               1.000000000000000,
                               0.999698818696204,
                               0.998795456205172,
                               0.997290456678690,
                               0.995184726672197,
                               0.992479534598710,
                               0.989176509964781,
                               0.985277642388941,
                               0.980785280403230,
                               0.975702130038529,
                               0.970031253194544,
                               0.963776065795440,
                               0.956940335732209,
                               0.949528180593037,
                               0.941544065183021,
                               0.932992798834739,
                               0.923879532511287,
                               0.914209755703531,
                               0.903989293123443,
                               0.893224301195515,
                               0.881921264348355,
                               0.870086991108711,
                               0.857728610000272,
                               0.844853565249707,
                               0.831469612302545,
                               0.817584813151584,
                               0.803207531480645,
                               0.788346427626606,
                               0.773010453362737,
                               0.757208846506485,
                               0.740951125354959,
                               0.724247082951467,
                               0.707106781186548,
                               0.689540544737067,
                               0.671558954847019,
                               0.653172842953777,
                               0.634393284163645,
                               0.615231590580627,
                               0.595699304492433,
                               0.575808191417845,
                               0.555570233019602,
                               0.534997619887097,
                               0.514102744193222,
                               0.492898192229784,
                               0.471396736825998,
                               0.449611329654607,
                               0.427555093430282,
                               0.405241314004990,
                               0.382683432365090,
                               0.359895036534988,
                               0.336889853392220,
                               0.313681740398891,
                               0.290284677254462,
                               0.266712757474898,
                               0.242980179903264,
                               0.219101240156870,
                               0.195090322016129,
                               0.170961888760301,
                               0.146730474455362,
                               0.122410675199216,
                               0.098017140329561,
                               0.073564563599668,
                               0.049067674327418,
                               0.024541228522912,
                               0.000000000000000,
                               -0.024541228522912,
                               -0.049067674327418,
                               -0.073564563599667,
                               -0.098017140329561,
                               -0.122410675199216,
                               -0.146730474455362,
                               -0.170961888760301,
                               -0.195090322016128,
                               -0.219101240156870,
                               -0.242980179903264,
                               -0.266712757474898,
                               -0.290284677254462,
                               -0.313681740398891,
                               -0.336889853392220,
                               -0.359895036534988,
                               -0.382683432365090,
                               -0.405241314004990,
                               -0.427555093430282,
                               -0.449611329654607,
                               -0.471396736825998,
                               -0.492898192229784,
                               -0.514102744193222,
                               -0.534997619887097,
                               -0.555570233019602,
                               -0.575808191417845,
                               -0.595699304492433,
                               -0.615231590580627,
                               -0.634393284163645,
                               -0.653172842953777,
                               -0.671558954847018,
                               -0.689540544737067,
                               -0.707106781186547,
                               -0.724247082951467,
                               -0.740951125354959,
                               -0.757208846506484,
                               -0.773010453362737,
                               -0.788346427626606,
                               -0.803207531480645,
                               -0.817584813151584,
                               -0.831469612302545,
                               -0.844853565249707,
                               -0.857728610000272,
                               -0.870086991108711,
                               -0.881921264348355,
                               -0.893224301195515,
                               -0.903989293123443,
                               -0.914209755703530,
                               -0.923879532511287,
                               -0.932992798834739,
                               -0.941544065183021,
                               -0.949528180593037,
                               -0.956940335732209,
                               -0.963776065795440,
                               -0.970031253194544,
                               -0.975702130038528,
                               -0.980785280403230,
                               -0.985277642388941,
                               -0.989176509964781,
                               -0.992479534598710,
                               -0.995184726672197,
                               -0.997290456678690,
                               -0.998795456205172,
                               -0.999698818696204,
                               -1.000000000000000,
                               -0.999698818696204,
                               -0.998795456205172,
                               -0.997290456678690,
                               -0.995184726672197,
                               -0.992479534598710,
                               -0.989176509964781,
                               -0.985277642388941,
                               -0.980785280403230,
                               -0.975702130038529,
                               -0.970031253194544,
                               -0.963776065795440,
                               -0.956940335732209,
                               -0.949528180593037,
                               -0.941544065183021,
                               -0.932992798834739,
                               -0.923879532511287,
                               -0.914209755703531,
                               -0.903989293123443,
                               -0.893224301195515,
                               -0.881921264348355,
                               -0.870086991108711,
                               -0.857728610000272,
                               -0.844853565249707,
                               -0.831469612302545,
                               -0.817584813151584,
                               -0.803207531480645,
                               -0.788346427626606,
                               -0.773010453362737,
                               -0.757208846506485,
                               -0.740951125354959,
                               -0.724247082951467,
                               -0.707106781186548,
                               -0.689540544737067,
                               -0.671558954847019,
                               -0.653172842953777,
                               -0.634393284163646,
                               -0.615231590580627,
                               -0.595699304492433,
                               -0.575808191417845,
                               -0.555570233019602,
                               -0.534997619887097,
                               -0.514102744193222,
                               -0.492898192229784,
                               -0.471396736825998,
                               -0.449611329654607,
                               -0.427555093430283,
                               -0.405241314004990,
                               -0.382683432365090,
                               -0.359895036534988,
                               -0.336889853392220,
                               -0.313681740398892,
                               -0.290284677254462,
                               -0.266712757474899,
                               -0.242980179903264,
                               -0.219101240156870,
                               -0.195090322016129,
                               -0.170961888760302,
                               -0.146730474455362,
                               -0.122410675199216,
                               -0.098017140329561,
                               -0.073564563599667,
                               -0.049067674327418,
                               -0.024541228522912

};

static double square_table[] = {
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0
};

double
wt_sample(wave_type type, double angle)
{
    double idx_exact = (angle / PI2) * WT_N_SAMPLES;
    double idx_low;
    double idx_frac = modf(idx_exact, &idx_low);
    int idx = idx_low;
    int next_idx = (idx < (WT_N_SAMPLES - 1)) ? idx + 1 : 0; // wrap it around!

    if (WAVETYPE_SINE == type) {
        return ((idx_frac * sine_table[idx]) +
                ((1.0 - idx_frac) * sine_table[next_idx]));
    } else if (WAVETYPE_SQUARE == type) {
        return ((idx_frac * square_table[idx]) +
                ((1.0 - idx_frac) * square_table[next_idx]));
    } else {
        return -1;
    }
}
